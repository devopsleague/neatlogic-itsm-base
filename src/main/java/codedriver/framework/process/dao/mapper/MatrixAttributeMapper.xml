<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="codedriver.framework.process.dao.mapper.MatrixAttributeMapper">
	<select id="getMatrixAttributeByMatrixUuid" parameterType="string" resultType="codedriver.framework.process.dto.ProcessMatrixAttributeVo.">
		SELECT
		`uuid`,
		`matrix_uuid`,
		`name`,
		`config`
		FROM `process_matrix_attribute`
		WHERE `matrix_uuid` = #{MatrixUuid}
		ORDER BY `id`
	</select>

	<select id="checkMatrixAttributeTableExist" parameterType="string" resultType="int">
		SELECT COUNT(`table_name`) FROM information_schema.TABLES WHERE table_name = #{tableName} limit 0,1;
	</select>

	<delete id="deleteAttributeByMatrixUuid" parameterType="string">
		DELETE FROM `process_matrix_attribute` WHERE `matrix_uuid` = #{matrixUuid}
	</delete>

	<insert id="insertMatirxAttribute" parameterType="codedriver.framework.process.dto.ProcessMatrixAttributeVo">
		INSERT INTO
		`process_matrix_attribute` (
			`matrix_uuid`,
			`uuid`,
			`name`,
			`config`
		) VALUES (
			#{matrixUuid},
			#{uuid},
			#{name},
			#{config}
		)
	</insert>

	<update id="createMatrixDynamicTable">
		CREATE table matrix_${matrixUuid}
		<foreach collection="attributeList" item="attribute" open="(" close=")" separator="," index="index">
			#{attribute.uuid} varchar(100) DEFAULT NULL
		</foreach>
	    ENGINE=InnoDB DEFAULT CHARSET=utf8

	</update>

	<update id="dropMatrixDynamicTable" parameterType="string">
		DROP TABLE matrix_${matrixUuid}
	</update>

	<update id="addMatrixDynamicTableColumn">
		ALTER TABLE matrix_${matrixUuid} ADD COLUMN ${columnName} VARCHAR(100)
	</update>

	<update id="dropMatrixDynamicTableColumn">
		ALTER TABLE matrix_${matrixUuid} DROP COLUMN ${columnName}
	</update>
</mapper>